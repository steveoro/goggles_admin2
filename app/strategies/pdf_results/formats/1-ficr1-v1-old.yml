#
# *** Layout format definition for the extracted text parser ***
#
# - The text is processed row by row (each line separated by a new-line "\n").
#
# - Each format file is processed, using the first page to detect which file
#   first matches all required conditions in the array (not marked as 'optional').
#
# - First match found, first match served.
#
1-ficr1:
  # For certain predefined lambda keys like 'spaced', 'starts_with' each
  # item in the array corresponds to a specific index line in the source file,
  # unless overridden with a subkey like 'at_fixed_row'.
  #
  # Fields must be enclosed in angle brackets (as in '<FIELD_NAME>')
  # Usually when a field is found => context start
  #
  # Row #0:
  - spaced: <description>
    repeat_each_page: true
    #
    # implied / default:
    #
    # at_fixed_row: 0
    # optional: false

  # Row #1:
  - spaced: <place_with_date>
    repeat_each_page: true

  # Row #2:
  - spaced: <event>
    repeat_each_page: true
    # Context start?
    named_context: true
    # Each named context is also stored for later reference
    # in siblings, using the 'parent' attribute

  # When no field is set, the string will be searched as is, unless the lambda key specifies
  # otherwise.
  #
  # Row #3:
  - spaced: Riepilogo
    repeat_each_page: true

  # Columns header
  # Row #4:
  - data_columns:
    - Pos.: \s?(\d{1,2}|SQ)
    - Nominativo: (\D+(\s\D+){1,3})
    - Naz: (\a{2,3})
    - Anno: \d{4}
    - SocietÃ :
    - Ser.:
    - Cor:
    - Pos:
    - Tempo:
    - Pti. SC:
    - Master:
    # Repeat this data line any number of times anywhere (default is false)
    # repeat: true
    # VS:
    # repeat_each_page: true (implied ?)
    # => repeat only @ exact line

  # Row #5:
  - spaced: <category>
    named_context: true
    # 'parent' already implies 'named_context', but by default
    # each 'named_context' starts from the previous, so 'parent' can be omitted
    # parent: event
    only_from_row: 5
    # Default:
    # repeat_each_page: false
    # Repeat the check any line after 5:
    repeat: true

  # Row #6:
  - empty_row:
    # No string of field key set implies ignore anything in this line
    only_from_row: 6
    # This line must be present whenever the previous context is found
    follow_up: true

  # Actual data starts here.
  # This will extract the data field(s) using the columns defined in 'data_columns'
  #
  # Row #7:
  - data_columns: <data>
    # parent: category
    # => MUST MATCH @columns defs formats
    # (NOTE: data_columns doesn't support 'named_context' as option; this is usable only when defining the columns)
    # Repeat this data line any number of times anywhere (default is false)
    # ("Repeatables" won't make the format def fail if they don't match)
    repeat: true
    # Whenever the @columns defs won't be applicable at all, this will break out to parent context:
    consequent_lines: true

  - spaced: Non Classificati
    optional: true
    # Optionals are basically a synonym of "repeatables" but may behave differently
    # depending on other options
    # Use index rows (0..N); won't search for this context unless row num is less then 7
    only_from_row: 7
    #
    # This, instead, will search for this line during any data context:
    # at_any_row: true
    #
    # Also, this line mustn't change the category context (which is the default for exact string matches):
    # named_context: false

  # Special End-Of-Page context marker may be taller than 1 line.
  #
  # This is set to span 6 lines before the page ends.
  # The special 'eop' key implies also that this context can be searched anytime
  # up to 6 rows before the end of page.
  - eop: 6
    starts_with: Elaborazione dati a cura della Federazione Italiana Cronometristi - www.ficr.it
    remainder: <pool_type>

  # Actual last-line context marker
  - last_row:
    spaced: Risultati su https://nuoto.ficr.it
