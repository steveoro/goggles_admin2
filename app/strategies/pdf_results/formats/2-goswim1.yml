#
# = Layout format definition for PdfResults::FormatParser
#
# 2022~ version with logo on top
#
2-goswim1:
  - name: pre_header
    at_fixed_row: 0
    required: false
    repeat: true
    row_span: 2
    rows:
      # "pre-header" row-0 (x2)
      - name: hdr_top0
        format: "^\\s{20,}FIN Emilia Romagna$"

  - name: header
    at_fixed_row: 0
    repeat: true
    rows:
      - name: hdr_row0
        fields:
          - name: edition
            required: false
            format: "^\\s{20,}(\\d{1,2}|[IVXLCM]+).{1,2}?\\s+"
            pop_out: false
          - name: meeting_name
            format: "^\\s{20,}(?>\\d{1,2}|[IVXLCM]+)?.{1,2}?\\s+(.+)$"
            pop_out: false

      - name: hdr_row1
        # This will match any empty row if the fields are not found:
        optional_if_empty: true
        fields:
          - name: meeting_name_ext
            required: false
            format: "^\\s{20,}(.+)$"

      # "header" row-2
      - fields:
        - name: meeting_place
          format: "^Luogo:\\s+((.{1,}['\\s]?)+)"
          token_end: 45

      # "header" row-3
      - fields:
        - name: hdr_results
          format: "^\\s{20,}RISULTATI"

      # "header" row-4
      - fields:
        - name: meeting_date
          format: "^Data:\\s+(\\d{2}[-\/]\\d{2}[-\/]\\d{2,4})\\s+Vasca:\\s*"
          pop_out: false
        - name: pool_type
          format: "^Data:\\s+(?>\\d{2}[-\/]\\d{2}[-\/]\\d{2,4})\\s+Vasca:\\s*(25|50)"
          pop_out: false

  - name: event
    # Repeat each page
    repeat: true
    parent: header
    rows:
      # "event" row-0:
      - name: event_sep0
        format: "^$"

      # "event" row-1:
      - fields:
        - name: event_length
          format: "^\\.\\s{10,}(\\d{2,4})\\s+"
          pop_out: false
        - name: event_type
          format: "^\\.\\s{10,}(?>\\d{2,4})\\s(Stile libero|Dorso|Farfalla|Rana)\\sMASTER\\s\\d{2,3}\\s(?>Masch|Femmin)ile - Serie\\s+"
          pop_out: false
        - name: gender_type
          format: "\\s(?>Stile libero|Dorso|Farfalla|Rana)\\sMASTER\\s\\d{2,3}\\s(Masch|Femmin)ile - Serie\\s+"
          pop_out: false
        - name: cat_title
          format: "\\s(?>Stile libero|Dorso|Farfalla|Rana)\\s(MASTER\\s\\d{2,3})\\s(?>Masch|Femmin)ile - Serie\\s+"
          pop_out: false

      # "event" row-2:
      - name: event_sep2
        format: "^$"

      # "event" row-3:
      - fields:
        - name: event_sub_hdr
          format: "^\\s{1,}POS ATLETA\\s{10,}ANNO\\s{10,}ARRIVO$"

      # "event" row-4:
      - fields:
        - name: event_sub_hdr2
          format: "^\\s{5,}SOCIETA\\s{20,}PUNTI$"

  # Actual data starts here:
  - name: results
    repeat: true
    parent: event
    # Start searching for this context at:
    starts_at_row: 11
    rows:
      # "results" row-0:
      - fields:
        - name: rank
          # Rank will be missing for DSQs:
          format: "^\\s?(\\d{1,2})?\\s+(?>\\w+(?>['`\\-\\w\\s]\\s?\\w*){1,6})\\s+\\d{4}\\s+"
          pop_out: false
          required: false
        - name: swimmer_name
          format: "^\\s?(?>\\d{1,2})?\\s+(\\w+(?>['`\\-\\w\\s]\\s?\\w*){1,6})\\s+\\d{4}\\s+"
          pop_out: false
        - name: year_of_birth
          format: "^\\s?(?>\\d{1,2})?\\s+(?>\\w+(?>['`\\-\\w\\s]\\s?\\w*){1,6})\\s+(\\d{4})\\s+"
          pop_out: false
        - name: timing
          format: "^\\s?(?>\\d{1,2})?\\s+(?>\\w+(?>['`\\-\\w\\s]\\s?\\w*){1,6})\\s+\\d{4}\\s+(\\d{1,2}?[':.]?\\d{1,2}[\":.]\\d{1,2}|Squalif|Non part|Assente)"
          # format: "^\\s?(?>\\d{1,2})?\\s+(?>\\w+\\s){2,}\\s+\\d{4}\\s+(\\d{1,2}?[':.]?\\d{1,2}[\":.]\\d{1,2}|Squalif|Non part|Assente)"
          pop_out: false

      # "results" row-1:
      - fields:
        - name: team_name
          format: "^\\s{5,}((?>[\\w\\.]+\\s){2,})(?>\\s+\\d?[,.]?\\d{0,4}|\\b)"
          pop_out: false
        - name: std_score
          format: "^\\s{5,}(?>(?>[\\w\\.]+\\s){2,})(?>\\s+(\\d?[,.]?\\d{0,4}[,.]\\d{1,2})|\\b)"
          # Absent => blank, not even zero
          required: false
          pop_out: false

      # "results" row-2 (optional, but most of the times a blank line is present):
      - name: dsq_details
        # This will match any empty row if the fields are not found:
        optional_if_empty: true
        required: false
        fields:
          - name: disqualify_type
            format: "^\\s{5,}-\\s((?>\\w+\\s){2,})$"
            pop_out: false

  # - name: empty_row
  #   parent: event
  #   required: false
  #   format: "^$"

  # End-Of-Page context
  - name: footer
    parent: event
    eop: true
    row_span: 4
    repeat: true
    starts_with: Elaborato da GoAndSwim
    fields:
      - name: page_num
        format: "\\s+Pagina\\s(\\d{1,3})\\sdi\\s\\d{1,3}"
