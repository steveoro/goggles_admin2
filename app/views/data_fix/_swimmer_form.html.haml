:ruby
  subkey_for_dom_id = swimmer_key.gsub(/[\s`'^?&%$!"<>:;,*]/, '_')
  src_dom = "#swimmer_#{subkey_for_dom_id}_id"
  target_dom = "#swimmer_#{subkey_for_dom_id}_swimmer_id"
  onchange_event = "$('#{target_dom}').val($('#{src_dom}').val()); $('#{target_dom}').trigger('change')"
  gender_type_opts = options_from_collection_for_select(GogglesDb::GenderType.all, 'id', 'label',
                                                        swimmer&.gender_type_id)

= form_for(swimmer, url: data_fix_update_path(swimmer, model: 'swimmer'), method: :patch) do |f|
  = hidden_field_tag('key', swimmer_key)
  = hidden_field_tag('file_path', file_path)
  .container
    .form-group
      .field
        = label_tag("swimmer[#{swimmer_key}][id]", 'fuzzy matches')
        = select_tag("swimmer[#{swimmer_key}][id]", options_from_collection_for_select(swimmer_matches || [], 'id',
                     'display_label', swimmer.id), include_blank: true, class: 'form-control', onchange: onchange_event)
    .row
      .col-auto
        = render(AutoCompleteComponent.new(base_dom_id: "swimmer[#{swimmer_key}]",
                base_api_url: api_url,
                default_value: swimmer.id,
                detail_endpoint: 'swimmer', base_name: 'swimmer', label_column: 'complete_name',
                search_endpoint: 'swimmers', search_column: 'complete_name',
                search2_dom_id: "swimmer_#{subkey_for_dom_id}_year_of_birth", search2_column: 'year_of_birth',
                target2_field: 'last_name', target2_column: 'last_name',
                target2_class: 'offset-lg-1 col-lg-3 col-md-5 col-sm-6 my-1',
                target3_field: 'first_name', target3_column: 'first_name',
                target3_class: 'col-lg-3 col-md-5 col-sm-6 my-1',
                target4_dom_id: "swimmer_#{subkey_for_dom_id}_gender_type_id", target4_column: 'gender_type_id',
                jwt: current_user.jwt))

      .col-lg-2.col-md-3.col-sm-4.my-2
        = number_field_tag("swimmer[#{swimmer_key}][year_of_birth]", swimmer&.year_of_birth, min: 1910,
                            max: Time.zone.today.year, required: true, autofocus: true, class: 'form-control')
      .col-lg-2.col-md-3.col-sm-4.my-2
        = select_tag("swimmer[#{swimmer_key}][gender_type_id]", gender_type_opts, class: 'form-control')

    .form-group
      = f.submit(t('data_import.generic_save_btn'), id: 'btn-save-session', class: 'btn btn-primary',
                 'aria-label': 'Save', type: 'submit',
                 data: { confirm: t('data_import.btn_save_confirm') })
